

inspect=>@"creates the edit-page web form, from 
where you can edit, delete and create new web pages, 
using a word-like wysiwyg editor, which you can inject 
web forms into"


magix.data.load
  prototype
    type=>magix.pages.page

_dt
  name=>value

for-each=>[magix.data.load][objects]
  set=>[/][_dt][0].Name
    value=>[.].Name
  set=>[/][_dt][0].Value
    value=>[.][name].Value
  add=>[/][magix.forms.create-web-part][controls][select][items]
    value=>[/][_dt][0]

magix.data.load
  prototype
    type=>magix.forms.form

for-each=>[magix.data.load:1][objects]
  set=>[/][_dt][0].Name
    value=>[.].Name
  set=>[/][_dt][0].Value
    value=>[.][name].Value
  add=>[/][magix.forms.create-web-part][controls][select:1][items]
    value=>[/][_dt][0]

magix.forms.create-web-part
  form-id=>edit-pages
  container=>content1
  css=>span-19 last
  controls
    label=>header
      tag=>h2
      css=>span-13 last left-6
      value=>edit pages
    select=>page
      css=>span-4
      onselectedindexchanged
        magix.forms.get-value
          form-id=>edit-pages
          id=>page
        set=>[magix.data.load][id].Value
          value=>[magix.forms.get-value][value].Value
        magix.data.load
        if=>more-than
          lhs=>[magix.data.load][objects].Count
          rhs=>0
          code
            set=>[magix.forms.set-value:0][value].Value
              value=>[magix.data.load][objects][0][name].Value
            set=>[magix.forms.set-value:1][value].Value
              value=>[magix.data.load][objects][0][value].Value
            magix.forms.set-enabled
              form-id=>edit-pages
              id=>delete
              value=>true
            magix.forms.set-visible
              form-id=>edit-pages
              id=>preview
              value=>true
            set=>[@][magix.forms.set-value][value].Value
              value=>tmp/{0}.png
                v0=>[/][magix.data.load][objects][0][name].Value
            magix.forms.set-value
              form-id=>edit-pages
              id=>imgQrCode
            magix.forms.set-visible
              form-id=>edit-pages
              id=>imgQrCode
              value=>true
        else
          magix.forms.set-enabled
            form-id=>edit-pages
            id=>delete
            value=>false
          magix.forms.set-visible
            form-id=>edit-pages
            id=>preview
            value=>false
          magix.forms.set-visible
            form-id=>edit-pages
            id=>imgQrCode
            value=>false
        magix.forms.set-value
          form-id=>edit-pages
          id=>name
          value=>
        magix.forms.set-value
          form-id=>wysiwyg-editor
          id=>wysiwyg
          value=>
      items
        default=>choose web page ...
    panel=>saveWrp
      css=>span-10
      default=>save
      controls
        text-box=>name
          place-holder=>name ...
          css=>span-4
        button=>save
          css=>span-3
          value=>save
          onclick
            magix.forms.get-value
              form-id=>edit-pages
              id=>name
            magix.forms.get-value
              form-id=>wysiwyg-editor
              id=>wysiwyg
            magix.forms.get-value
              form-id=>edit-pages
              id=>page
            if=>not-exist
              lhs=>[magix.forms.get-value:0][value].Value
              code
                magix.viewport.show-message
                  message=>no name given to page
            else
              set=>[@][magix.data.save][value][name].Value
                value=>[magix.forms.get-value][value].Value
              set=>[@][magix.data.remove][prototype][name].Value
                value=>[magix.forms.get-value][value].Value
              set=>[@][magix.data.save][value][name].Value
                value=>[magix.forms.get-value][value].Value
              set=>[@][magix.data.save][value][value].Value
                value=>[magix.forms.get-value:1][value].Value
              magix.data.remove
                prototype
                  type=>magix.pages.page
              magix.data.save
                value
                  type=>magix.pages.page
              magix.viewport.show-message
                message=>page was successfully saved
              magix.data.load
                prototype
                  type=>magix.pages.page
              _id
              for-each=>[@][magix.data.load][objects]
                if=>equals
                  lhs=>[.][name].Value
                  rhs=>[/][magix.forms.get-value][value].Value
                  code
                    set=>[@][..][..][..][_id].Value
                      value=>[.].Name
                _dt
                  name=>value
                set=>[@][_dt][0].Name
                  value=>[.].Name
                set=>[@][_dt][0].Value
                  value=>[.][name].Value
                add=>[@][..][_lst]
                  value=>[@][_dt][0]
              _lst
                default=>choose web page ...
              for-each=>[@][_lst]
                add=>[@][..][magix.forms.set-values][values]
                  value=>[.]
              magix.forms.set-values
                form-id=>edit-pages
                id=>page
              set=>[@][magix.forms.set-value][value].Value
                value=>[@][_id].Value
              magix.forms.set-value
                form-id=>edit-pages
                id=>page
              set=>[@][magix.log.append][body][pr0].Value
                value=>[/][magix.forms.get-value][value].Value
              magix.log.append
                header=>page created
                body=>@"page {0} was created or modified"
              magix.forms.set-enabled
                form-id=>edit-pages
                id=>delete
                value=>true
              magix.forms.set-visible
                form-id=>edit-pages
                id=>preview
                value=>true
              magix.web.get-base-directory
              set=>[@][magix.qr.create][url].Value
                value=>{0}?page={1}
                  v0=>[@][magix.web.get-base-directory][value].Value
                  v1=>[/][magix.forms.get-value][value].Value
              set=>[@][magix.qr.create][file-name].Value
                value=>tmp/{0}.png
                  v0=>[/][magix.forms.get-value][value].Value
              magix.qr.create
                size=>4
                err=>Q
              set=>[@][magix.forms.set-value:1][value].Value
                value=>tmp/{0}.png
                  v0=>[/][magix.forms.get-value][value].Value
              magix.forms.set-value
                form-id=>edit-pages
                id=>imgQrCode
              magix.forms.set-visible
                form-id=>edit-pages
                id=>imgQrCode
                value=>true
        button=>delete
          css=>span-3 last
          value=>delete
          disabled=>true
          onclick
            magix.viewport.confirm
              message=>please confirm deletion of page
              code
                magix.forms.get-value
                  form-id=>edit-pages
                  id=>name
                set=>[magix.data.load][prototype][name].Value
                  value=>[magix.forms.get-value][value].Value
                magix.data.load
                  prototype
                    type=>magix.pages.page
                if=>not-exist
                  lhs=>[magix.data.load][objects]
                  code
                    magix.viewport.show-message
                      message=>no such page
                else
                  set=>[@][magix.data.remove][id].Value
                    value=>[/][magix.data.load][objects][0].Name
                  magix.data.remove
                  magix.viewport.show-message
                    message=>page removed
                  magix.forms.set-value
                    form-id=>wysiwyg-editor
                    id=>wysiwyg
                    value=>
                  magix.forms.set-value
                    form-id=>edit-pages
                    id=>name
                    value=>
                  magix.data.load
                    prototype
                      type=>magix.pages.page
                  for-each=>[@][magix.data.load][objects]
                    _dt
                      name=>value
                    set=>[@][_dt][0].Name
                      value=>[.].Name
                    set=>[@][_dt][0].Value
                      value=>[.][name].Value
                    add=>[@][..][_lst]
                      value=>[@][_dt][0]
                  _lst
                    default=>choose web page ...
                  for-each=>[@][_lst]
                    add=>[@][..][magix.forms.set-values][values]
                      value=>[.]
                  magix.forms.set-values
                    form-id=>edit-pages
                    id=>page
                  magix.forms.set-value
                    form-id=>edit-pages
                    id=>page
                    value=>default
                  set=>[@][magix.log.append][body][pr0].Value
                    value=>[magix.forms.get-value][value].Value
                  magix.log.append
                    header=>page deleted
                    body=>@"page {0} was deleted"
                  magix.forms.set-enabled
                    form-id=>edit-pages
                    id=>delete
                    value=>false
                  magix.forms.set-visible
                    form-id=>edit-pages
                    id=>preview
                    value=>false
                  magix.forms.set-visible
                    form-id=>edit-pages
                    id=>imgQrCode
                    value=>false
                  set=>[@][magix.file.delete].Value
                    value=>tmp/{0}.png
                      v0=>[/][magix.forms.get-value][value].Value
    select=>form
      css=>span-3
      onselectedindexchanged
        magix.forms.get-value
          form-id=>edit-pages
          id=>form
        if=>not-equals
          lhs=>[magix.forms.get-value][value].Value
          rhs=>default
          code
            set=>[@][magix.data.load][id].Value
              value=>[magix.forms.get-value][value].Value
            magix.data.load
            set=>[@][set:2][value][pr0].Value
              value=>[@][magix.data.load][objects][0][name].Value
            set=>[@][magix.viewport.execute-javascript][script].Value
              value=>@"window.actualEditor.composer.commands.exec('insertHTML', '{{{{form=>{0}}}}}');"
            magix.viewport.execute-javascript
            magix.forms.set-value
              form-id=>edit-pages
              id=>form
              value=>default
      items
        default=>insert form ...
    button=>preview
      css=>span-2 last
      value=>preview
      visible=>false
      onclick
        magix.forms.get-value
          form-id=>edit-pages
          id=>name
        set=>[magix.viewport.execute-javascript][script][v0].Value
          value=>[magix.forms.get-value][value].Value
        magix.viewport.execute-javascript
          script=>@"window.open('?page={0}', '_blank').focus();"
    image=>imgQrCode
      visible=>false
      alt=>qr code
      tip=>@"qr code for accessing page through qr code scanner. 
qr code is smaller than what appears once downloaded.
right-click, or drag-n-drop, to download and use in paper-based 
marketing material, to have a qr code to access this specific page"
      css=>qr-code-preview


magix.forms.create-web-part
  form-id=>wysiwyg-editor
  container=>content2
  css=>span-24
  parent-css=>span-24
  controls
    wysiwyg=>wysiwyg
      css=>wysiwyg span-24
      place-holder=>your text ...

